# Story 2.2: Dynamic Interval Adjustment Hotkey

## Status
Done

## Story
**As a** user,
**I want** to hold a hotkey and use my mouse wheel to change the click interval,
**so that** I can adjust the click speed on the fly.

## Acceptance Criteria
1. The application uses the user-configured hotkey for interval adjustment.
2. When this hotkey is held down and enabled, scrolling the mouse wheel up decreases the click interval (speeds up clicking).
3. When this hotkey is held down and enabled, scrolling the mouse wheel down increases the click interval (slows down clicking).
4. The interval adjustment is proportional to the scroll speed (faster scroll, larger change).
5. A checkbox in the UI allows the user to enable or disable this hotkey.
6. The interval display in the main window updates in real-time as it is adjusted.

## Tasks / Subtasks
- [x] Define the hotkey combination for dynamic interval adjustment. (Default: Ctrl + Alt + Scroll)
- [x] Update `hotkeys.rs` to detect scroll events while modifiers are held.
- [x] Define new `HotkeyEvent::IntervalChange(i32)`.
- [x] Update `app.rs` to handle `IntervalChange` message.
- [x] Implement logic in `app.rs` to change `interval_ms` based on scroll delta.
- [x] Connect "Enable Dynamic Interval Adjustment" checkbox to this logic.
- [x] Refactor `ClickingEngine` to use `AtomicU64` for dynamic interval updates.
- [x] Implement non-linear scaling for scroll speed (acceleration).
- [x] Adjust scaling factor for 1ms fine adjustments.

## Dev Notes
- The dynamic interval adjustment hotkey is **Ctrl + Alt + Scroll**.
- `rdev` listener in `hotkeys.rs` detects scroll events while `Ctrl` and `Alt` are held, sending `HotkeyEvent::IntervalChange`. This handles global events (background app or foreground app with mouse outside window).
- `ClickingEngine` was refactored to use `Arc<AtomicU64>` for `interval` to allow real-time updates from the main `Iced` thread.
- `app.rs` implements non-linear acceleration for scroll adjustments: fine 1ms steps for slow scrolling, and larger steps when scrolling quickly.
- The "Enable Dynamic Interval Adjustment" checkbox in the UI controls this feature.
- **Known Issue:** The dynamic interval adjustment hotkey (Ctrl + Alt + Scroll) does not function when the SuperClicker window is in the foreground, but the mouse cursor is *outside* the window. This is due to `iced`'s local event subscription only capturing mouse events within its bounds, and `rdev`'s global hook being less reliable for mouse wheel events when the application is focused. This behavior will be addressed in a future refactor.

## File List
- super_clicker/src/clicking.rs
- super_clicker/src/hotkeys.rs
- super_clicker/src/app.rs

## Testing
- Manually test dynamic interval adjustment with the hotkey and scroll wheel (both fine and fast adjustments).
- Verify interval changes correctly and UI updates.
- Test enabling/disabling the feature via UI checkbox.
- Verify hotkey toggle (Ctrl+Alt+F6) still works as expected.

## Change Log
| Date       | Version | Description                               | Author |
| :--------- | :------ | :------------ | :----- |
| 2025-11-27 | 1.3     | Implemented 1ms fine adjustment and acceleration. | James  |
| 2025-11-27 | 1.2     | Refactored `ClickingEngine` for dynamic interval. | James  |
| 2025-11-27 | 1.1     | Set to In Progress | James  |
| 2025-11-27 | 1.0     | Initial Draft | John   |
