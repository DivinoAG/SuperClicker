# Story 5.1: Tech Debt - Consolidate Input Libraries

## Status
Done

## Story
**As a** developer,
**I want** to consolidate the input handling libraries (`rdev` and `global-hotkey`) into a single, cohesive solution,
**so that** the project reduces its dependency count, simplifies maintenance, and eliminates potential conflicts or redundant functionality.

## Acceptance Criteria
1. The project uses only one primary library for both mouse simulation and global hotkey detection.
2. The chosen library fully supports both functionalities required by the application.
3. All existing mouse clicking and hotkey toggling functionality remains intact.
4. The codebase is updated to use only the consolidated input library.
5. The `Cargo.toml` file reflects the removal of the unnecessary input library.

## Tasks / Subtasks
- [x] Research capabilities of `rdev` for global hotkey detection.
- [x] Research capabilities of `global-hotkey` for mouse simulation.
- [x] Evaluate if one library can replace the other entirely for all current and future needs. (Decision: Use `rdev` for everything).
- [x] Create a new `InputManager` (or update `hotkeys.rs`) to run `rdev::listen` in a separate thread.
- [x] Integrate this listener into `app.rs` using an `iced::Subscription`.
- [x] Implement logic to detect the specific hotkey (Ctrl+Alt+F6) within the `rdev` event stream.
- [x] Remove `global-hotkey` usage and dependency.
- [x] Verify that mouse simulation still works in `clicking.rs` (ensure no conflicts with the listener).
- [x] Update `docs/architecture/tech-stack.md`.

## Dev Notes
- Switched to `rdev` for both listening and simulating.
- `hotkeys.rs` now runs `rdev::listen` in a spawned thread and sends events to Iced via `iced::subscription::channel` for background detection.
- Added `hotkeys::subscribe_local` using `iced::event::listen` to handle hotkeys when the window is focused (addressing `rdev` limitation on some systems).
- Implemented 300ms debouncing in `app.rs` to prevent double-toggling when both listeners detect the event.
- `app.rs` no longer polls for hotkeys; it reacts to subscription events.
- `global-hotkey` dependency removed.

## File List
- super_clicker/Cargo.toml
- super_clicker/src/app.rs
- super_clicker/src/hotkeys.rs
- docs/architecture/tech-stack.md

## Testing
- Run all existing manual and automated tests for clicking and hotkey functionality.
- Verify no regressions occur after refactoring.

## Change Log
| Date       | Version | Description                               | Author |
| :--------- | :------ | :---------------------------------------- | :----- |
| 2025-11-27 | 1.3     | Fixed focus issue (Hybrid approach)       | James  |
| 2025-11-27 | 1.2     | Implemented rdev consolidation            | James  |
| 2025-11-27 | 1.1     | Cleaned up story text & set to In Progress| James  |
| 2025-11-27 | 1.0     | Initial Draft                             | John   |
